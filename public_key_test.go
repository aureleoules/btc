package btc

import (
	"reflect"
	"strings"
	"testing"

	"github.com/stretchr/testify/assert"
)

func TestGetPublicKey(t *testing.T) {
	var wifArray = []struct {
		WIF     string
		Network *Network
		X       string
		Y       string
	}{
		// Main network
		{"5JKmGh5KasctVb3o9p1eNZmgqgRNvAUTmVBs9aca5VJHHMFtMgc", MainNetwork, "94199638460339516669064035806819509557845470234024708380991157490745625887461", "54083449022663392508147741242912037981561821775290570569793708283362887964722"},
		{"5JqLR1PX9UWPkiPus9ontEPXo4KitgoiYCkHaFoDh5hJdDJJmcK", MainNetwork, "42387995307237826434754787419007831111230874724789793343385733389797684851", "86169477900944296571822801798839818066696895173285295494704785443290890379942"},
		{"5K9LPKv2VsbmAMhcEiNQnU2bTiNavtap1Ex6EMN1MFkTRZHi26E", MainNetwork, "70067853651479995177693488201083171446230153301655041651406139402055394702562", "47025331434943430360016248296642421509393119020606367647692702178951082732050"},
		{"5KMWmt74aaabx8bxumCoXzniNwfdPTTP4y2SG8D31Mzt79FemR9", MainNetwork, "87290897931703691238679009992642490285289830965256510074892293515044125193378", "23757110026022741404723541138281280143080464763041281039544546403843659041132"},
		{"5JE6ctXTzE8JK5Qaw1FUtR9kNiYsyBicuwdR2jn982sfn9BL2Ku", MainNetwork, "69840781979325786272537167981560351894064674609263318363174807841966654370289", "82938824860119808593992611841822942122051714982437775837979360532170452176693"},
		{"5JhpbHXjDJTuPxeXs53FBY4Hd4oZoS1RboswXNn3udEG6XtTdA8", MainNetwork, "45413414859231125040966507612571354847318717731234298567687710512794184696980", "30507183370717390786906388992677235648543147292076448799316111210335435436895"},
		{"5K9uGdHuajFab23DZFCv3EBN2bRwkifZiZRNbUoUgyn9g8UFMTu", MainNetwork, "15629854871576648256898131577715412909723789349496211937454709073480709307694", "12232758451332534133404606413155186638903114511596549186569158525711025546290"},

		// Test network
		{"931krx7yFnVSoHb1JxeN1W2rrhWARbNfiK3BA3xVZZrfgALvkMy", TestNetwork, "2072779824030601892023602317971046922633137422006114995373969146147251245593", "111367008410412548832387998911870782212396716641541369710207726981765593914797"},
		{"91imyYBEzyfb2d45tX81JucjFsCvidtKYwxbZXP6f431rY1mV8E", TestNetwork, "30121757235740649182431506006991350951674725383220809513372811460437197416995", "84738295428427773812529924296411133738022697647327337499533401669839946252068"},
		{"923jG4W4c83BacqWFTLHYCwaRw2YRR9umK9ZeQ2CtJfRLZLC8k6", TestNetwork, "60165574869215030714643779658149154815116791033013263935610054722278933938133", "87696934251101765229319095715249798696879735187722831666281722138278655776088"},
		{"92Bsm5dR62dXoEeTVAD899EEAtKBQoBQ68BnX4GC98TWnnaTWT5", TestNetwork, "30076639271076814124993507619810328989372217750737486133968510005401479660755", "108059705823937390160193066577887038677675391102018634941729809480878672976199"},
		{"92iDRThnHRquXbFLgZVdYzFjVUYz8difQtwjeMRRULKNbxNWkKV", TestNetwork, "76057552513823893717230329928467558996877140952655788856592513853306373507844", "43475695055664201722853295107051704340310022312178129155081173673039676139404"},
	}

	for _, value := range wifArray {
		privateKey, err := PrivateFromWIF(value.WIF, value.Network)
		if err != nil {
			t.Fatal(err)
		}
		publicKey, valid := privateKey.GetPublicKey()

		assert.Equal(t, true, valid)
		assert.Equal(t, true, reflect.DeepEqual(value.Network, publicKey.Network))
		assert.Equal(t, value.X, publicKey.X.String())
		assert.Equal(t, value.Y, publicKey.Y.String())
	}
}

func TestFormat(t *testing.T) {
	var wifArray = []struct {
		WIF             string
		Network         *Network
		UncompressedHex string
		CompressedHex   string
	}{
		// Main network
		{"5JKmGh5KasctVb3o9p1eNZmgqgRNvAUTmVBs9aca5VJHHMFtMgc", MainNetwork, "04D0431B1FB23BF0D4D9B95B26419CBA50409D0FA610E9274B2F418BDCA20D42E5779225B9A70BFC715149B73AE91BC31A22D1B123F4872C5F31864725A5A59832", "02D0431B1FB23BF0D4D9B95B26419CBA50409D0FA610E9274B2F418BDCA20D42E5"},

		{"5JqLR1PX9UWPkiPus9ontEPXo4KitgoiYCkHaFoDh5hJdDJJmcK", MainNetwork, "040017FDA2210BFCBCC11D7E8845883D8A5C60A72DE7EA840A4D20A9E92681F673BE823236512B1E28DA42AA7446C39EB70B562C24CC299F0978ECD7C8F37C22A6", "020017FDA2210BFCBCC11D7E8845883D8A5C60A72DE7EA840A4D20A9E92681F673"},

		{"5K9LPKv2VsbmAMhcEiNQnU2bTiNavtap1Ex6EMN1MFkTRZHi26E", MainNetwork, "049AE8FFF14B9C8379DB533015D01E33BC89B8EB8DB32993D8AE9BC332833AB4E267F764F5F7502D4B92AE79F4B2F4E7800BC3F438FDDF2757CB93519943BAEA12", "029AE8FFF14B9C8379DB533015D01E33BC89B8EB8DB32993D8AE9BC332833AB4E2"},

		{"5KMWmt74aaabx8bxumCoXzniNwfdPTTP4y2SG8D31Mzt79FemR9", MainNetwork, "04C0FCE5BB12B2409B9CF31507BBC6CAB82E8F2C8EBF4E099E285D9DDC3E00B4A234860C3A4F917A8F3F8B63D3F260F3BB6E0FED4B46C40B5479CE8AB2DD14896C", "02C0FCE5BB12B2409B9CF31507BBC6CAB82E8F2C8EBF4E099E285D9DDC3E00B4A2"},

		{"5JE6ctXTzE8JK5Qaw1FUtR9kNiYsyBicuwdR2jn982sfn9BL2Ku", MainNetwork, "049A687B54DD8733A2B69B7D044BD7A01ACEB8E9B8C1E2EE3A7334090219EE31F1B75DB61904F97FD0E0C689C1FFC0387B1EDD2E199448F7F4D41A2E1341730F35", "039A687B54DD8733A2B69B7D044BD7A01ACEB8E9B8C1E2EE3A7334090219EE31F1"},

		{"5JhpbHXjDJTuPxeXs53FBY4Hd4oZoS1RboswXNn3udEG6XtTdA8", MainNetwork, "04646714F9321FB41ECBAA175C63123D56E3DE3D4A918B630E1B72778DB57BC49443727431FCF6B88748976DAC81DC2585F8BFA4A52EBC7FD3AF1416580FCB335F", "03646714F9321FB41ECBAA175C63123D56E3DE3D4A918B630E1B72778DB57BC494"},

		{"5K9uGdHuajFab23DZFCv3EBN2bRwkifZiZRNbUoUgyn9g8UFMTu", MainNetwork, "04228E2F323D732B82315AE0DB2D040871B9E5B4BD6A21278C7FC8A9220F4BFD2E1B0B7EF4E024CFF10735275FC0BF987E21C69E9294E322FE4B3A2E3E47F5A432", "02228E2F323D732B82315AE0DB2D040871B9E5B4BD6A21278C7FC8A9220F4BFD2E"},

		// Test network
		{"931krx7yFnVSoHb1JxeN1W2rrhWARbNfiK3BA3xVZZrfgALvkMy", TestNetwork, "04049526DCB9206C71CFC81B94D6D8737C85D330A147C0D97A332E906B10ED5219F6377E35CBAC734CC328EC81272B7678E27CD02ECA9CC07032101199CB055DAD", "03049526DCB9206C71CFC81B94D6D8737C85D330A147C0D97A332E906B10ED5219"},

		{"91imyYBEzyfb2d45tX81JucjFsCvidtKYwxbZXP6f431rY1mV8E", TestNetwork, "0442984F78154E452C0A60D208A5B8D910EE3EBEFE7580FE1F967E633B295F6A23BB582CF204D801B0F3B8178577A96B4CFBD4E822A8A39E8E77483992DD0FFF24", "0242984F78154E452C0A60D208A5B8D910EE3EBEFE7580FE1F967E633B295F6A23"},

		{"923jG4W4c83BacqWFTLHYCwaRw2YRR9umK9ZeQ2CtJfRLZLC8k6", TestNetwork, "0485048233A536EDE62124BD18E3768E74083DFB0A400C8BCC7E442E74D2D03FD5C1E2B4AF34C798AD774A272230A79C6C3F8A39BC932A54AC7AAEE7CED2015558", "0285048233A536EDE62124BD18E3768E74083DFB0A400C8BCC7E442E74D2D03FD5"},

		{"92Bsm5dR62dXoEeTVAD899EEAtKBQoBQ68BnX4GC98TWnnaTWT5", TestNetwork, "04427EC649C34A1CB3E69B48C4238DAC32AFA5ABE6474A11B530DF204C8DF9C4D3EEE7A046D61279149C50926223863C6AF61805A7414572ADEB74A09189AA1947", "03427EC649C34A1CB3E69B48C4238DAC32AFA5ABE6474A11B530DF204C8DF9C4D3"},

		{"92iDRThnHRquXbFLgZVdYzFjVUYz8difQtwjeMRRULKNbxNWkKV", TestNetwork, "04A8270C97E7B2C17D83A90A51024E2D5BD7C3DE8D57ED75ABC473DB9EBB4D8B04601E5F130F0DC2B23FA2FF4BDC92D3FDEB61D9017C5F86A079F29E2CCF79678C", "02A8270C97E7B2C17D83A90A51024E2D5BD7C3DE8D57ED75ABC473DB9EBB4D8B04"},
	}

	for _, value := range wifArray {
		privateKey, err := PrivateFromWIF(value.WIF, value.Network)
		if err != nil {
			t.Fatal(err)
		}
		publicKey, valid := privateKey.GetPublicKey()

		assert.Equal(t, true, valid)
		assert.Equal(t, true, reflect.DeepEqual(value.Network, publicKey.Network))
		assert.Equal(t, strings.ToLower(value.UncompressedHex), strings.ToLower(publicKey.Format(false)))
		assert.Equal(t, strings.ToLower(value.CompressedHex), strings.ToLower(publicKey.Format(true)))
	}
}
